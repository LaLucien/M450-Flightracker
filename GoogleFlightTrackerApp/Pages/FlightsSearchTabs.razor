@page "/flights/search"
@using FlightTracker.Contracts
@using MudBlazor
@using System.Globalization
@inject NavigationManager NavigationManager

<PageTitle>Search flights</PageTitle>

@code {
 private string? origin;
 private string? destination;
 private string? departureDate;
 private int flexDays =3;

 protected override void OnInitialized()
 {
 var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
 var query = ParseQuery(uri.Query);
 if (query.TryGetValue("origin", out var o)) origin = o;
 if (query.TryGetValue("destination", out var d)) destination = d;
 if (query.TryGetValue("departure_date", out var dd)) departureDate = dd;
 if (query.TryGetValue("flex_days", out var fd) && int.TryParse(fd, out var parsed)) flexDays = parsed;
 }

 private static Dictionary<string, string> ParseQuery(string query)
 {
 var dict = new Dictionary<string, string>();
 if (string.IsNullOrEmpty(query)) return dict;
 var q = query.TrimStart('?');
 foreach (var part in q.Split('&', StringSplitOptions.RemoveEmptyEntries))
 {
 var idx = part.IndexOf('=');
 if (idx >=0)
 {
 var key = Uri.UnescapeDataString(part.Substring(0, idx));
 var val = Uri.UnescapeDataString(part.Substring(idx +1));
 dict[key] = val;
 }
 else
 {
 var key = Uri.UnescapeDataString(part);
 dict[key] = string.Empty;
 }
 }
 return dict;
 }
}

<MudContainer Class="mt-4">
 <MudPaper Class="pa-4">
 <MudText Typo="Typo.h5">Search results</MudText>
 <MudText Typo="Typo.subtitle2">@((origin ?? "") + (string.IsNullOrEmpty(origin) ? "" : " → ") + (destination ?? "") ) @if(!string.IsNullOrEmpty(departureDate)){<span> • @departureDate</span>}</MudText>

 <MudTabs Class="mt-4">
 <MudTab Label="Flights">
 <Flights ShowFilter="false" />
 </MudTab>
 </MudTabs>
 </MudPaper>
</MudContainer>